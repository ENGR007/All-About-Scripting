<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Handwritten Notebook</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #f3f3f3;
    color: #222;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
  }
  h1 {
    font-size: 1.4rem;
    margin: 5px 0 10px;
    text-align: center;
  }

  .app-container {
    width: 100%;
    max-width: 980px;
    background: #ffffff;
    border-radius: 10px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.12);
    padding: 10px 10px 15px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    position: relative;
  }

  /* Notebook selector row */
  .notebook-row {
    display: flex;
    gap: 8px;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    padding-bottom: 4px;
    border-bottom: 1px solid #ddd;
  }
  .notebook-row select {
    padding: 4px 6px;
    font-size: 0.9rem;
    border-radius: 5px;
    border: 1px solid #ccc;
  }
  .notebook-row button {
    padding: 4px 8px;
    font-size: 0.85rem;
  }

  .fullscreen-topbar {
    display: none;
    text-align: center;
    font-size: 0.8rem;
    padding: 4px 6px;
    background: #333;
    color: #fff;
    border-radius: 6px;
    cursor: pointer;
  }

  .toolbar-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
    justify-content: space-between;
  }
  .toolbar-group {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    align-items: center;
  }
  .toolbar-label {
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    color: #555;
  }

  button {
    border: 1px solid #ccc;
    background: #f8f8f8;
    border-radius: 5px;
    padding: 4px 8px;
    font-size: 0.85rem;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }
  button.active {
    border-color: #0052cc;
    background: #e7f0ff;
  }

  .color-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 1px solid #999;
  }
  .color-black { background: #000; }
  .color-blue { background: #0052cc; }
  .color-red { background: #cc0000; }
  .color-yellow { background: #ffd54f; }

  .page-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    align-items: center;
    justify-content: space-between;
  }
  .page-title-input {
    flex: 1;
    min-width: 160px;
    padding: 4px 6px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 0.9rem;
  }

  .notebook-wrapper {
    margin-top: 4px;
    border-radius: 8px;
    border: 1px solid #ddd;
    overflow: hidden;
    background: #fdfcf8;
    position: relative;
    height: min(70vh, 640px);
    -webkit-user-select: none;
    user-select: none;
  }
  .page-surface {
    position: relative;
    width: 100%;
    height: 100%;
    background-image: linear-gradient(to bottom, rgba(0,0,0,0.05) 1px, transparent 1px);
    background-size: 100% 24px;
    background-color: #fffbf3;
    padding-left: 40px;
    -webkit-user-select: none;
    user-select: none;
    touch-action: none;
  }
  .page-surface::before {
    content: "";
    position: absolute;
    top: 0; bottom: 0; left: 30px;
    border-left: 2px solid rgba(255,0,0,0.35);
    pointer-events: none;
  }
  #drawingCanvas {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    touch-action: none;
    -webkit-user-select: none;
    user-select: none;
  }

  .note-meta { display: flex; flex-direction: column; gap: 4px; margin-top: 6px; }
  .note-meta textarea {
    width: 100%;
    min-height: 60px;
    resize: vertical;
    padding: 5px 6px;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-size: 0.85rem;
  }

  .audio-section {
    margin-top: 6px;
    padding: 6px 4px;
    border-radius: 6px;
    border: 1px solid #eee;
    background: #fafafa;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .audio-controls { display: flex; gap: 6px; flex-wrap: wrap; }
  .audio-list { display: flex; flex-direction: column; gap: 4px; }
  .audio-row { display: flex; flex-wrap: wrap; gap: 6px; font-size: 0.8rem; }

  .search-row { margin-top: 4px; display: flex; flex-direction: column; gap: 4px; }
  .search-input {
    width: 100%;
    padding: 4px 6px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  .export-import-row {
    margin-top: 4px;
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }

  .footer {
    margin-top: 6px;
    font-size: 0.75rem;
    text-align: center;
    color: #777;
  }

  /* FULLSCREEN */
  .fullscreen .toolbar-row,
  .fullscreen .note-meta,
  .fullscreen .search-row,
  .fullscreen .export-import-row,
  .fullscreen .audio-section,
  .fullscreen .page-controls,
  .fullscreen .footer,
  .fullscreen .notebook-row {
    display: none;
  }
  .fullscreen .fullscreen-topbar { display: block; }
  .fullscreen .notebook-wrapper { height: calc(100vh - 60px); }

  @media (max-width: 600px) {
    .toolbar-row, .page-controls { flex-direction: column; align-items: stretch; }
  }
</style>
</head>
<body>

<h1>Handwritten Notebook</h1>
<div class="app-container">

  <!-- NOTEBOOK MANAGER -->
  <div class="notebook-row">
    <div>
      <span class="toolbar-label">Notebook:</span>
      <select id="notebookSelect"></select>
    </div>
    <button id="newNotebookBtn">‚ûï New Notebook</button>
  </div>

  <div id="fullscreenTopBar" class="fullscreen-topbar">Tap here to exit full screen</div>

  <!-- TOOLBAR -->
  <div class="toolbar-row">
    <div class="toolbar-group">
      <span class="toolbar-label">Tools</span>
      <button id="toolPen" class="active">‚úèÔ∏è Pen</button>
      <button id="toolHighlighter">üñç Highlighter</button>
      <button id="toolEraser">ü©π Eraser</button>
      <button id="undoBtn">‚Ü∂ Undo</button>
      <button id="redoBtn">‚Ü∑ Redo</button>
      <button id="clearPageBtn">üóë Clear</button>
    </div>

    <div class="toolbar-group">
      <span class="toolbar-label">Pen</span>
      <button data-color="black" class="color-btn active"><span class="color-dot color-black"></span>Black</button>
      <button data-color="blue" class="color-btn"><span class="color-dot color-blue"></span>Blue</button>
      <button data-color="red" class="color-btn"><span class="color-dot color-red"></span>Red</button>
      <button data-color="yellow" class="color-btn"><span class="color-dot color-yellow"></span>Yellow</button>

      <label class="toolbar-label">Size
        <input id="sizeSlider" type="range" min="1" max="15" value="1" />
      </label>
    </div>
  </div>

  <!-- PAGE CONTROLS -->
  <div class="page-controls">
    <div class="toolbar-group">
      <button id="prevPageBtn">‚óÄ Prev</button>
      <button id="nextPageBtn">Next ‚ñ∂</button>
      <button id="addPageBtn">‚ûï Add Page</button>
      <span id="pageInfo"></span>
    </div>

    <div class="toolbar-group">
      <input id="pageTitle" class="page-title-input" placeholder="Page title..." />
      <button id="fullscreenToggleBtn">Full Screen</button>
    </div>
  </div>

  <!-- CANVAS -->
  <div class="notebook-wrapper">
    <div class="page-surface">
      <canvas id="drawingCanvas"></canvas>
    </div>
  </div>

  <!-- NOTES -->
  <div class="note-meta">
    <label for="pageText">Typed notes / keywords:</label>
    <textarea id="pageText"></textarea>
  </div>

  <!-- AUDIO -->
  <div class="audio-section">
    <label>Audio Notes (per page):</label>
    <div class="audio-controls">
      <button id="startRecordBtn">Start Recording</button>
      <button id="stopRecordBtn" disabled>Stop</button>
      <span id="recordStatus">Recording status: Idle</span>
    </div>
    <div id="audioList" class="audio-list"></div>
  </div>

  <!-- SEARCH -->
  <div class="search-row">
    <label>Search Pages:</label>
    <input id="searchInput" class="search-input" placeholder="Search titles or typed notes..." />
    <div id="searchResults" class="search-results"></div>
  </div>

  <!-- EXPORT -->
  <div class="export-import-row">
    <button id="exportBtn">‚¨á Export Notebook</button>
    <button id="importBtn">‚¨Ü Import Notebook</button>
    <input id="importFile" type="file" accept="application/json" style="display:none" />
  </div>

  <div class="footer">
    All notebooks stored locally in your browser. Use Export/Import for backup.
  </div>
</div>

<script>
/* ============================================================
   NOTEBOOK SYSTEM (Multiple Notebook Support)
   ============================================================ */

const NOTEBOOK_LIST_KEY = "NOTEBOOK_LIST";
const LAST_NOTEBOOK_KEY = "LAST_NOTEBOOK_USED";

/* Load notebook list */
function loadNotebookList() {
  const raw = localStorage.getItem(NOTEBOOK_LIST_KEY);
  if (!raw) return ["Default Notebook"];
  try {
    const list = JSON.parse(raw);
    return Array.isArray(list) && list.length ? list : ["Default Notebook"];
  } catch {
    return ["Default Notebook"];
  }
}

/* Save notebook list */
function saveNotebookList(list) {
  localStorage.setItem(NOTEBOOK_LIST_KEY, JSON.stringify(list));
}

/* Save last opened notebook */
function setLastNotebook(name) {
  localStorage.setItem(LAST_NOTEBOOK_KEY, name);
}

/* Load last opened notebook */
function getLastNotebook() {
  return localStorage.getItem(LAST_NOTEBOOK_KEY);
}

/* UI for notebook selector */
const notebookSelect = document.getElementById("notebookSelect");
const newNotebookBtn = document.getElementById("newNotebookBtn");

let NOTEBOOK_LIST = loadNotebookList();
let currentNotebookName = getLastNotebook() || NOTEBOOK_LIST[0];

/* Fill dropdown */
function refreshNotebookDropdown() {
  notebookSelect.innerHTML = "";
  NOTEBOOK_LIST.forEach(name => {
    const opt = document.createElement("option");
    opt.value = name;
    opt.textContent = name;
    if (name === currentNotebookName) opt.selected = true;
    notebookSelect.appendChild(opt);
  });
}
refreshNotebookDropdown();

/* Helper to access a notebook's storage key */
function storageKeyForNotebook(name) {
  return "NOTEBOOK_DATA_" + name.replace(/\W+/g, "_");
}

/* ============================================================
   OLD NOTEBOOK LOGIC (per notebook)
   ============================================================ */

let pages = [];
let currentPageIndex = 0;

const canvas = document.getElementById("drawingCanvas");
const ctx = canvas.getContext("2d");

let isDrawing = false;
let currentStroke = null;

let currentTool = "pen";
let currentSize = 1;
let currentColor = "black";

let pencilIsDown = false;

/* Audio */
let mediaRecorder = null;
let recordedChunks = [];
let currentStream = null;
let isRecordingAudio = false;
const audioSupported = !!(navigator.mediaDevices && window.MediaRecorder);

/* UI references */
const startRecordBtn = document.getElementById("startRecordBtn");
const stopRecordBtn = document.getElementById("stopRecordBtn");
const recordStatus = document.getElementById("recordStatus");
const audioListEl = document.getElementById("audioList");

/* ============================================================
   NOTEBOOK LOAD / SAVE
   ============================================================ */

function createBlankPage() {
  return {
    title: "",
    text: "",
    strokes: [],
    undoStack: [],
    redoStack: [],
    audio: []
  };
}

function loadNotebook(notebookName) {
  const key = storageKeyForNotebook(notebookName);
  const raw = localStorage.getItem(key);

  if (!raw) {
    pages = [createBlankPage()];
    currentPageIndex = 0;
    saveNotebook();
    return;
  }

  try {
    const parsed = JSON.parse(raw);
    pages = parsed.pages || [createBlankPage()];
    currentPageIndex = parsed.currentPageIndex || 0;
  } catch {
    pages = [createBlankPage()];
    currentPageIndex = 0;
  }
}

function saveNotebook() {
  const key = storageKeyForNotebook(currentNotebookName);
  localStorage.setItem(
    key,
    JSON.stringify({ pages, currentPageIndex })
  );
}

/* ============================================================
   PAGE & UI HELPERS
   ============================================================ */

function updatePageInfo() {
  document.getElementById("pageInfo").textContent =
    `Page ${currentPageIndex + 1} / ${pages.length}`;
}

function resizeCanvas() {
  const rect = canvas.parentElement.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;
  redrawFullPage();
}

window.addEventListener("resize", resizeCanvas);

/* Redraw everything (only when switching pages, resizing, undo/redo) */
function redrawFullPage() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const page = pages[currentPageIndex];
  if (!page) return;

  for (const stroke of page.strokes) {
    drawFullStroke(stroke);
  }
}

/* Draw entire stroke (for redraw) */
function drawFullStroke(stroke) {
  if (!stroke.points.length) return;

  prepareStrokeStyle(stroke);

  ctx.beginPath();
  ctx.moveTo(stroke.points[0].x, stroke.points[0].y);

  for (let i = 1; i < stroke.points.length; i++) {
    ctx.lineTo(stroke.points[i].x, stroke.points[i].y);
  }
  ctx.stroke();
}

/* Draw only new segment (for Apple-Notes smoothness) */
function drawLatestSegment(stroke) {
  const pts = stroke.points;
  if (pts.length < 2) return;

  prepareStrokeStyle(stroke);

  const p1 = pts[pts.length - 2];
  const p2 = pts[pts.length - 1];

  ctx.beginPath();
  ctx.moveTo(p1.x, p1.y);
  ctx.lineTo(p2.x, p2.y);
  ctx.stroke();
}

function prepareStrokeStyle(stroke) {
  if (stroke.tool === "eraser") {
    ctx.globalCompositeOperation = "destination-out";
    ctx.lineWidth = stroke.size * 3;
    ctx.strokeStyle = "rgba(0,0,0,1)";
  } else if (stroke.tool === "highlighter") {
    ctx.globalCompositeOperation = "source-over";
    ctx.lineWidth = stroke.size * 3;
    ctx.strokeStyle = "rgba(255, 235, 59, 0.45)";
  } else {
    ctx.globalCompositeOperation = "source-over";
    ctx.lineWidth = stroke.size * 2;
    ctx.strokeStyle = getColorValue(stroke.color);
  }

  ctx.lineCap = "round";
  ctx.lineJoin = "round";
}

function getColorValue(name) {
  return {
    blue: "#0052cc",
    red: "#cc0000",
    yellow: "#ffd54f",
    black: "#000"
  }[name] || "#000";
}

/* ============================================================
   STROKE ENGINE
   ============================================================ */

function startStroke(x, y) {
  const page = pages[currentPageIndex];
  page.redoStack = [];

  currentStroke = {
    tool: currentTool,
    color: currentColor,
    size: currentSize,
    points: [{ x, y }]
  };

  page.strokes.push(currentStroke);
  isDrawing = true;

  drawLatestSegment(currentStroke);
}

function addPoint(x, y) {
  if (!isDrawing || !currentStroke) return;
  currentStroke.points.push({ x, y });
  drawLatestSegment(currentStroke);
}

function endStroke() {
  if (!isDrawing) return;
  isDrawing = false;

  const page = pages[currentPageIndex];
  if (currentStroke && currentStroke.points.length) {
    page.undoStack.push(currentStroke);
  }
  currentStroke = null;

  saveNotebook();
}

/* ============================================================
   POINTER EVENTS (Finger + Pencil + Palm Rejection)
   ============================================================ */

function getXY(evt) {
  const rect = canvas.getBoundingClientRect();
  return {
    x: evt.clientX - rect.left,
    y: evt.clientY - rect.top
  };
}

canvas.addEventListener("pointerdown", evt => {
  if (pencilIsDown && evt.pointerType === "touch") return;

  if (evt.pointerType === "pen") {
    pencilIsDown = true;
  }

  const { x, y } = getXY(evt);
  startStroke(x, y);
});

canvas.addEventListener("pointermove", evt => {
  if (!isDrawing) return;
  const { x, y } = getXY(evt);
  addPoint(x, y);
});

canvas.addEventListener("pointerup", evt => {
  if (evt.pointerType === "pen") pencilIsDown = false;
  endStroke();
});

canvas.addEventListener("pointercancel", evt => {
  if (evt.pointerType === "pen") pencilIsDown = false;
  endStroke();
});

/* ============================================================
   UNDO / REDO / CLEAR
   ============================================================ */

document.getElementById("undoBtn").onclick = () => {
  const page = pages[currentPageIndex];
  if (!page.strokes.length) return;

  const stroke = page.strokes.pop();
  page.redoStack.push(stroke);

  redrawFullPage();
  saveNotebook();
};

document.getElementById("redoBtn").onclick = () => {
  const page = pages[currentPageIndex];
  if (!page.redoStack.length) return;

  const stroke = page.redoStack.pop();
  page.strokes.push(stroke);

  redrawFullPage();
  saveNotebook();
};

document.getElementById("clearPageBtn").onclick = () => {
  if (!confirm("Clear this page?")) return;

  const page = pages[currentPageIndex];
  page.strokes = [];
  page.undoStack = [];
  page.redoStack = [];

  redrawFullPage();
  saveNotebook();
};

/* ============================================================
   PAGE NAVIGATION
   ============================================================ */

function goToPage(index) {
  if (index < 0 || index >= pages.length) return;

  currentPageIndex = index;
  document.getElementById("pageTitle").value = pages[index].title;
  document.getElementById("pageText").value = pages[index].text;
  updatePageInfo();
  redrawFullPage();
  renderAudioList();
  saveNotebook();
}

document.getElementById("addPageBtn").onclick = () => {
  pages.push(createBlankPage());
  goToPage(pages.length - 1);
};

document.getElementById("prevPageBtn").onclick = () => {
  if (currentPageIndex > 0) goToPage(currentPageIndex - 1);
};

document.getElementById("nextPageBtn").onclick = () => {
  if (currentPageIndex < pages.length - 1) goToPage(currentPageIndex + 1);
};

/* ============================================================
   TITLE + TEXT SAVE
   ============================================================ */

document.getElementById("pageTitle").oninput = e => {
  pages[currentPageIndex].title = e.target.value;
  saveNotebook();
};
document.getElementById("pageText").oninput = e => {
  pages[currentPageIndex].text = e.target.value;
  saveNotebook();
};

/* ============================================================
   SEARCH
   ============================================================ */

document.getElementById("searchInput").oninput = e => {
  const q = e.target.value.trim().toLowerCase();
  const results = document.getElementById("searchResults");
  results.innerHTML = "";
  if (!q) return;

  pages.forEach((p, i) => {
    const hay = (p.title + " " + p.text).toLowerCase();
    if (hay.includes(q)) {
      const btn = document.createElement("button");
      btn.textContent = `Page ${i + 1}: ${p.title || "(Untitled)"}`;
      btn.onclick = () => goToPage(i);
      results.appendChild(btn);
    }
  });

  if (!results.children.length) {
    results.textContent = "No matches found.";
  }
};

/* ============================================================
   AUDIO RECORDING
   ============================================================ */

function dataUrlToBlob(dataUrl) {
  const parts = dataUrl.split(",");
  const mime = parts[0].match(/:(.*?);/)[1];
  const binary = atob(parts[1]);
  const bytes = new Uint8Array(binary.length);
  for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
  return new Blob([bytes], { type: mime });
}

function renderAudioList() {
  const page = pages[currentPageIndex];
  audioListEl.innerHTML = "";

  if (!page.audio.length) {
    audioListEl.textContent = "No audio notes yet.";
    return;
  }

  page.audio.forEach((clip, idx) => {
    const row = document.createElement("div");
    row.className = "audio-row";

    const audio = document.createElement("audio");
    audio.controls = true;
    audio.src = URL.createObjectURL(dataUrlToBlob(clip.dataUrl));

    const name = document.createElement("span");
    name.textContent = clip.name;

    const download = document.createElement("button");
    download.textContent = "Download";
    download.onclick = () => {
      const blob = dataUrlToBlob(clip.dataUrl);
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = clip.name.replace(/\W+/g, "_") + ".webm";
      a.click();
      URL.revokeObjectURL(url);
    };

    const del = document.createElement("button");
    del.textContent = "Delete";
    del.onclick = () => {
      if (!confirm("Delete this audio?")) return;
      page.audio.splice(idx, 1);
      saveNotebook();
      renderAudioList();
    };

    row.append(audio, name, download, del);
    audioListEl.appendChild(row);
  });
}

async function startRecording() {
  if (!audioSupported || isRecordingAudio) return;

  try {
    currentStream = await navigator.mediaDevices.getUserMedia({ audio: true });

    let options = {};
    if (MediaRecorder.isTypeSupported("audio/mp4")) {
      options.mimeType = "audio/mp4";
    } else if (MediaRecorder.isTypeSupported("audio/webm")) {
      options.mimeType = "audio/webm";
    }

    mediaRecorder = new MediaRecorder(currentStream, options);
    recordedChunks = [];
    mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);

    mediaRecorder.onstop = () => {
      isRecordingAudio = false;
      startRecordBtn.disabled = false;
      stopRecordBtn.disabled = true;

      currentStream.getTracks().forEach(t => t.stop());

      if (!recordedChunks.length) return;

      const blob = new Blob(recordedChunks, { type: mediaRecorder.mimeType });
      const reader = new FileReader();

      reader.onloadend = () => {
        const page = pages[currentPageIndex];
        const dataUrl = reader.result;
        page.audio.push({
          name: `Audio ${page.audio.length + 1}`,
          dataUrl
        });
        saveNotebook();
        renderAudioList();
      };

      reader.readAsDataURL(blob);
    };

    mediaRecorder.start();
    isRecordingAudio = true;
    startRecordBtn.disabled = true;
    stopRecordBtn.disabled = false;
    recordStatus.textContent = "Recording...";
  } catch {
    recordStatus.textContent = "Recording failed.";
  }
}

function stopRecording() {
  if (!isRecordingAudio) return;
  recordStatus.textContent = "Stopping...";
  mediaRecorder.stop();
}

startRecordBtn.onclick = startRecording;
stopRecordBtn.onclick = stopRecording;

/* ============================================================
   EXPORT / IMPORT
   ============================================================ */

document.getElementById("exportBtn").onclick = () => {
  const dataStr = JSON.stringify({ pages, currentPageIndex });
  const blob = new Blob([dataStr], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `${currentNotebookName.replace(/\W+/g, "_")}.json`;
  a.click();

  URL.revokeObjectURL(url);
};

document.getElementById("importBtn").onclick = () => {
  document.getElementById("importFile").click();
};

document.getElementById("importFile").onchange = e => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = ev => {
    try {
      const parsed = JSON.parse(ev.target.result);
      pages = parsed.pages || [createBlankPage()];
      currentPageIndex = parsed.currentPageIndex || 0;
      redrawFullPage();
      renderAudioList();
      saveNotebook();
      alert("Notebook imported.");
    } catch {
      alert("Invalid notebook file.");
    }

    e.target.value = "";
  };

  reader.readAsText(file);
};

/* ============================================================
   NOTEBOOK SWITCHING
   ============================================================ */

notebookSelect.onchange = () => {
  currentNotebookName = notebookSelect.value;
  setLastNotebook(currentNotebookName);
  loadNotebook(currentNotebookName);
  resizeCanvas();
  updatePageInfo();
  document.getElementById("pageTitle").value = pages[currentPageIndex].title;
  document.getElementById("pageText").value = pages[currentPageIndex].text;
  renderAudioList();
};

newNotebookBtn.onclick = () => {
  const name = prompt("Enter new notebook name:");
  if (!name) return;

  if (NOTEBOOK_LIST.includes(name)) {
    alert("Notebook already exists.");
    return;
  }

  NOTEBOOK_LIST.push(name);
  saveNotebookList(NOTEBOOK_LIST);
  refreshNotebookDropdown();

  currentNotebookName = name;
  setLastNotebook(name);

  pages = [createBlankPage()];
  currentPageIndex = 0;
  saveNotebook();
  resizeCanvas();
  updatePageInfo();
  renderAudioList();
};

/* ============================================================
   INITIALIZE
   ============================================================ */

loadNotebook(currentNotebookName);
refreshNotebookDropdown();

resizeCanvas();
updatePageInfo();

document.getElementById("pageTitle").value = pages[currentPageIndex].title;
document.getElementById("pageText").value = pages[currentPageIndex].text;

renderAudioList();
</script>
</body>
</html>