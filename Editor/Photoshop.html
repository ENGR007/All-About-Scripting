<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Advanced Photo Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        margin: 0;
        background: #111;
        overflow: hidden;
        color: white;
        font-family: system-ui;
    }

    .topbar {
        padding: 10px 10px;
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        font-size: 22px;
    }

    .topbar button {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
    }

    .editor {
        width: 100vw;
        height: calc(100vh - 180px);
        background: white;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    canvas {
        max-width: 100%;
        max-height: 100%;
        background: white;
    }

    .panel {
        padding: 15px;
        background: #000;
        border-top: 1px solid #333;
    }

    .tool-buttons {
        display: flex;
        gap: 12px;
        margin-bottom: 10px;
    }

    .tool-buttons button {
        background: #222;
        border: 1px solid #444;
        color: white;
        padding: 8px 14px;
        border-radius: 6px;
        cursor: pointer;
    }

    .tool-buttons button.active {
        background: #4d8aff;
        border-color: #4d8aff;
    }

    .instruction {
        color: #aaa;
        font-size: 12px;
        margin-top: 8px;
    }
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
    <button id="uploadBtn">üì§</button>
    <button id="downloadBtn">‚¨áÔ∏è</button>
</div>

<!-- CANVAS AREA -->
<div class="editor">
    <canvas id="canvas"></canvas>
</div>

<!-- TOOL PANEL -->
<div class="panel">
    <div class="tool-buttons">
        <button id="healBtn">Heal</button>
        <button id="cloneBtn">Clone</button>
        <button id="eraseBtn">Eraser</button>
    </div>

    <input id="sizeSlider" type="range" min="5" max="80" value="30">

    <div class="instruction">
        ‚Ä¢ Clone = ALT + click to select source ‚Üí paint to clone<br>
        ‚Ä¢ Heal = Soft blur blend over painted area<br>
        ‚Ä¢ Eraser = Remove pixels (white)
    </div>
</div>

<script>
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");

let img = new Image();
let drawing = false;
let tool = "heal";
let cloneSource = null;

canvas.width = window.innerWidth;
canvas.height = window.innerHeight - 180;

/* ===== Upload Image ===== */
document.getElementById("uploadBtn").onclick = () => {
    let input = document.createElement("input");
    input.type = "file";
    input.accept = "image/*";
    input.onchange = e => {
        img.src = URL.createObjectURL(e.target.files[0]);
        img.onload = () => {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
        };
    };
    input.click();
};

/* ===== Download Image ===== */
document.getElementById("downloadBtn").onclick = () => {
    let link = document.createElement("a");
    link.download = "edited.png";
    link.href = canvas.toDataURL();
    link.click();
};

/* ===== Tool Buttons ===== */
function activate(btn) {
    document.querySelectorAll(".tool-buttons button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
}

document.getElementById("healBtn").onclick = e => {
    tool = "heal"; activate(e.target);
};
document.getElementById("cloneBtn").onclick = e => {
    tool = "clone"; activate(e.target);
};
document.getElementById("eraseBtn").onclick = e => {
    tool = "erase"; activate(e.target);
};

activate(document.getElementById("healBtn")); // default tool

let brushSize = document.getElementById("sizeSlider").value;
document.getElementById("sizeSlider").oninput = e => {
    brushSize = e.target.value;
};

/* ===== Mouse Events ===== */
canvas.onmousedown = e => {
    drawing = true;

    if (tool === "clone" && e.altKey) {
        cloneSource = { x: e.offsetX, y: e.offsetY };
        return;
    }
};

canvas.onmouseup = () => drawing = false;
canvas.onmouseleave = () => drawing = false;

canvas.onmousemove = e => {
    if (!drawing) return;

    const x = e.offsetX;
    const y = e.offsetY;

    if (tool === "erase") {
        ctx.clearRect(x - brushSize/2, y - brushSize/2, brushSize, brushSize);

    } else if (tool === "heal") {
        let temp = ctx.getImageData(x - brushSize/2, y - brushSize/2, brushSize, brushSize);

        // Average blur (simple heal)
        for (let i=0; i<temp.data.length; i+=4) {
            temp.data[i] = (temp.data[i] + 255) / 2;
            temp.data[i+1] = (temp.data[i+1] + 255) / 2;
            temp.data[i+2] = (temp.data[i+2] + 255) / 2;
        }

        ctx.putImageData(temp, x - brushSize/2, y - brushSize/2);

    } else if (tool === "clone" && cloneSource) {
        let dx = x - cloneSource.x;
        let dy = y - cloneSource.y;

        ctx.drawImage(
            canvas,
            cloneSource.x - brushSize/2, cloneSource.y - brushSize/2,
            brushSize, brushSize,
            x - brushSize/2, y - brushSize/2,
            brushSize, brushSize
        );
    }
};
</script>

</body>
</html>