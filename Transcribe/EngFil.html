<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Filipino ‚Üî English Translator + Live Speech Input</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #020617;
      --card: #020617;
      --border: #1f2937;
      --accent: #0ea5e9;
      --accent-soft: rgba(56,189,248,0.15);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #fecaca;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 14px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 50%, #020617 100%);
      color: var(--text);
    }

    .app {
      max-width: 900px; margin: 0 auto;
      background: var(--card); border-radius: 16px;
      padding: 16px; border: 1px solid var(--border);
      box-shadow: 0 20px 45px rgba(0,0,0,0.65);
    }

    h1 {
      font-size: 1.2rem; margin:0 0 6px;
      display:flex; align-items:center; gap:8px;
    }

    .subtitle { font-size:0.8rem; color:var(--muted); margin-bottom:10px; }

    textarea {
      width:100%; min-height:140px;
      background:#020617; color:var(--text);
      border:1px solid var(--border);
      border-radius:10px; padding:8px;
      font-size:0.9rem;
    }

    textarea:focus {
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 1px var(--accent-soft);
    }

    .row {
      display:grid; grid-template-columns:1fr 1fr;
      gap:12px; margin-top:10px;
    }
    @media(max-width:720px){ .row{grid-template-columns:1fr;} }

    .swap-row {
      display:flex; justify-content:space-between;
      align-items:center; gap:8px; margin-top:6px;
    }

    .swap-btn {
      padding:4px 10px; border-radius:999px;
      border:1px solid var(--border);
      background:#020617; color:var(--text);
      font-size:0.8rem; cursor:pointer;
    }

    .pill {
      font-size:0.7rem; padding:3px 8px;
      border-radius:999px; 
      background:var(--accent-soft);
      border:1px solid rgba(56,189,248,0.5);
      color:#bae6fd;
    }

    button {
      margin-top:8px;
      border:none; padding:10px;
      border-radius:999px; cursor:pointer;
      display:inline-flex; align-items:center;
      gap:6px; font-size:0.85rem;
    }

    .btn-rec {
      background:linear-gradient(135deg, #ef4444, #f87171);
      color:white; width:100%;
      margin-top:15px;
    }
    .btn-stop {
      background:#374151; color:white;
      width:100%; margin-top:5px;
    }

    .btn-copy { background:linear-gradient(135deg, #0ea5e9,#38bdf8); color:#0b1120; }
    .btn-clear { background:#111827; border:1px solid var(--border); color:var(--text); }

    .status { margin-top:10px; font-size:0.75rem; color:var(--muted); }
    .error { min-height:16px; font-size:0.78rem; color:var(--danger); }
  </style>
</head>

<body>
  <div class="app">
    <h1>üåê Filipino ‚Üî English Translator</h1>
    <div class="subtitle">Now supports LIVE speech input for both languages.</div>

    <button class="btn-rec" id="startSpeech">üé§ Start Speech</button>
    <button class="btn-stop" id="stopSpeech">‚èπ Stop</button>

    <div class="swap-row">
      <div class="pill">Mode: <span id="modeLabel">Filipino ‚Üí English</span></div>
      <button type="button" class="swap-btn" id="btnSwap">‚áÑ Swap directions</button>
    </div>

    <div class="row">
      <div>
        <textarea id="sourceText" placeholder="Mag-type o magsalita ng Filipino dito‚Ä¶"></textarea>
      </div>
      <div>
        <textarea id="targetText" placeholder="Translation appears here‚Ä¶" readonly></textarea>
      </div>
    </div>

    <div class="row" style="margin-top:8px;">
      <button class="btn-copy" id="btnCopy">üìã Copy translation</button>
      <button class="btn-clear" id="btnClear">üßπ Clear</button>
    </div>

    <div class="status" id="statusText">Status: Idle</div>
    <div class="error" id="errorBox"></div>
  </div>

<script>
/* ================================
   SPEECH RECOGNITION (iPhone Safe)
================================ */
let SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition;

if (SpeechRecognition) {
  recognition = new SpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;

  // SAFARI REQUIREMENT ‚Äî works for Filipino + English
  recognition.lang = "en-US";
}

/* ================================
   MODE + UI
================================ */
const src = document.getElementById("sourceText");
const tgt = document.getElementById("targetText");
const modeLabel = document.getElementById("modeLabel");
let modeFilToEng = true;

function updateMode() {
  if (modeFilToEng) {
    modeLabel.textContent = "Filipino ‚Üí English";
    src.placeholder = "Mag-type o magsalita ng Filipino dito‚Ä¶";
    tgt.placeholder = "English translation will appear here‚Ä¶";
  } else {
    modeLabel.textContent = "English ‚Üí Filipino";
    src.placeholder = "Type or speak English here‚Ä¶";
    tgt.placeholder = "Lalabas dito ang Filipino translation‚Ä¶";
  }
}

updateMode();

document.getElementById("btnSwap").onclick = () => {
  modeFilToEng = !modeFilToEng;
  const a = src.value; const b = tgt.value;
  src.value = b; tgt.value = a;
  updateMode();
  doTranslate();
};

/* ================================
   LIVE SPEECH LOGIC
================================ */
document.getElementById("startSpeech").onclick = () => {
  try { recognition.start(); } catch(e){}
  document.getElementById("statusText").innerText = "Status: Listening‚Ä¶";
};

document.getElementById("stopSpeech").onclick = () => {
  recognition.stop();
  document.getElementById("statusText").innerText = "Status: Stopped.";
};

recognition.onresult = (event) => {
  let text = "";
  for (let i = event.resultIndex; i < event.results.length; i++) {
    text += event.results[i][0].transcript;
  }
  src.value = text;
  doTranslate();
};

/* ================================
   TRANSLATION ENGINE
================================ */
async function translateGoogle(text, sl, tl) {
  const url =
    "https://translate.googleapis.com/translate_a/single?client=gtx" +
    `&sl=${sl}&tl=${tl}&dt=t&q=` + encodeURIComponent(text);

  const res = await fetch(url);
  if (!res.ok) return "";
  const data = await res.json();
  return data[0].map(v => v[0]).join("");
}

async function translateMyMemory(text, sl, tl) {
  const url =
    "https://api.mymemory.translated.net/get?q=" +
    encodeURIComponent(text) +
    `&langpair=${sl}|${tl}`;
  const res = await fetch(url);
  if (!res.ok) return "";
  const data = await res.json();
  return data?.responseData?.translatedText || "";
}

async function doTranslate() {
  const text = src.value.trim();
  tgt.value = "";
  document.getElementById("statusText").innerText = "Status: Translating‚Ä¶";

  if (!text) {
    document.getElementById("statusText").innerText = "Status: Idle.";
    return;
  }

  const sl = modeFilToEng ? "tl" : "en";
  const tl = modeFilToEng ? "en" : "tl";

  try {
    let result = await translateGoogle(text, sl, tl);
    if (!result) result = await translateMyMemory(text, sl, tl);
    tgt.value = result;
    document.getElementById("statusText").innerText = "Status: Done.";
  } catch (e) {
    tgt.value = "";
    document.getElementById("statusText").innerText = "Status: Error.";
  }
}

/* ================================
   BUTTONS
================================ */
document.getElementById("btnClear").onclick = () => {
  src.value = "";
  tgt.value = "";
};

document.getElementById("btnCopy").onclick = async () => {
  try {
    await navigator.clipboard.writeText(tgt.value);
    document.getElementById("statusText").innerText = "Status: Translation copied.";
  } catch {
    document.getElementById("statusText").innerText = "Status: Copy failed.";
  }
};
</script>
</body>
</html>