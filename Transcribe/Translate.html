<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Stable Real-Time Speech Translator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { background:#eef2f7; font-family:Arial; padding:18px; }
.container {
  max-width:900px; margin:auto; background:white; padding:20px;
  border-radius:12px; box-shadow:0 3px 12px rgba(0,0,0,0.1);
}
button {
  width:100%; padding:12px; margin-top:10px; font-size:18px;
  border:none; border-radius:8px; color:white; background:#007bff;
}
button:active { opacity:0.6; }
textarea, select {
  width:100%; padding:10px; margin-top:10px; font-size:16px;
}
textarea { height:140px; resize:vertical; }
.subtitles {
  background:black; color:#0f0; padding:10px; height:90px;
  border-radius:8px; margin-top:10px; overflow-y:auto;
}
</style>
</head>

<body>

<div class="container">
  <h2>ğŸ¤ Stable Speech Translator (iPhone Compatible)</h2>

  <h3>Input Language (Speech Recognition)</h3>
  <select id="inputLang">
    <option value="en-US">English ğŸ‡ºğŸ‡¸</option>
    <option value="tl-PH">Filipino ğŸ‡µğŸ‡­</option>
    <option value="zh-CN">Chinese ğŸ‡¨ğŸ‡³</option>
    <option value="ja-JP">Japanese ğŸ‡¯ğŸ‡µ</option>
    <option value="ko-KR">Korean ğŸ‡°ğŸ‡·</option>
  </select>

  <h3>Translate To</h3>
  <select id="targetLang">
    <option value="en">English ğŸ‡ºğŸ‡¸</option>
    <option value="tl">Filipino ğŸ‡µğŸ‡­</option>
    <option value="zh-CN">Chinese ğŸ‡¨ğŸ‡³</option>
    <option value="ja">Japanese ğŸ‡¯ğŸ‡µ</option>
    <option value="ko">Korean ğŸ‡°ğŸ‡·</option>
  </select>

  <button id="startBtn">Start Speaking ğŸ¤</button>
  <button id="stopBtn" style="background:#dc3545;">Stop</button>

  <h3>Your Speech</h3>
  <textarea id="spokenText" readonly></textarea>

  <h3>Translation</h3>
  <textarea id="translatedText" readonly></textarea>

  <h3>Live Subtitles</h3>
  <div class="subtitles" id="subtitles"></div>

  <p id="status" style="opacity:.7;">Status: Idle</p>
</div>

<script>

let recognition;

if ("webkitSpeechRecognition" in window)
    recognition = new webkitSpeechRecognition();
else if ("SpeechRecognition" in window)
    recognition = new SpeechRecognition();
else
    alert("Speech Recognition not supported on this browser.");

recognition.continuous = true;
recognition.interimResults = true;

document.getElementById("startBtn").onclick = () => {
    let inLang = document.getElementById("inputLang").value;
    recognition.lang = inLang; // USE ONLY ONE LANGUAGE (Safari requirement)

    recognition.start();
    document.getElementById("status").innerText = "Status: Listeningâ€¦";
};

document.getElementById("stopBtn").onclick = () => {
    recognition.stop();
    document.getElementById("status").innerText = "Status: Stopped";
};

// GOOGLE TRANSLATE API (unofficial)
async function googleTranslate(text, target) {
    const url =
      "https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=" +
      target + "&dt=t&q=" + encodeURIComponent(text);

    let res = await fetch(url);
    let data = await res.json();
    return data[0].map(x => x[0]).join("");
}

recognition.onresult = async (event) => {
    let text = "";

    for (let i = event.resultIndex; i < event.results.length; i++)
        text += event.results[i][0].transcript;

    document.getElementById("spokenText").value = text;
    document.getElementById("subtitles").innerText = text;

    if (!text.trim()) return;

    let target = document.getElementById("targetLang").value;

    let translated = await googleTranslate(text, target);

    document.getElementById("translatedText").value = translated;

    speak(translated, target);
};

function speak(text, lang) {
    const synth = window.speechSynthesis;
    if (!synth) return;

    let utter = new SpeechSynthesisUtterance(text);
    utter.lang = lang;
    synth.speak(utter);
}

</script>
</body>
</html>